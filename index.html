<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ЁЯОЙ ро╡ро┐ро┤ро╛ рокрогродрпН родрпКроХрпБрокрпНрокрпБ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px; 
            color: #333;
            min-height: 100vh;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
        }
        .header { 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            text-align: center; 
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-bottom: 5px solid #4CAF50;
        }
        .header h1 { 
            color: #333; 
            margin-bottom: 10px; 
            font-size: 2.2em;
        }
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .form-group { margin-bottom: 20px; }
        .form-input { 
            width: 100%; 
            padding: 14px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            font-size: 16px;
            transition: border 0.3s;
        }
        .form-input:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        .btn { 
            padding: 14px 25px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600;
            background: #4CAF50; 
            color: white;
            margin: 5px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn:hover { 
            background: #45a049; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .btn-small {
            padding: 10px 15px;
            font-size: 14px;
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-info {
            background: #3498db;
        }
        .btn-info:hover {
            background: #2980b9;
        }
        .btn-warning {
            background: #f39c12;
        }
        .btn-warning:hover {
            background: #e67e22;
        }
        .event-card { 
            background: #f8f9fa; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 10px; 
            border-left: 5px solid #4CAF50;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        .participant-card { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #2196F3;
            border: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .empty-state { 
            text-align: center; 
            padding: 40px; 
            color: #666; 
            font-style: italic;
            background: #f9f9f9;
            border-radius: 8px;
            margin: 10px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        .stat-label {
            color: #666;
            font-size: 1em;
            font-weight: 500;
        }
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        .participant-form {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px dashed #b3d9ff;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .section-title {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
        }
        .section-title i {
            margin-right: 10px;
            font-size: 1.2em;
        }
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .event-details {
            flex: 1;
            min-width: 300px;
        }
        .participant-info {
            display: flex;
            flex-direction: column;
        }
        .participant-details {
            color: #666;
            margin: 5px 0;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
            display: none;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
            display: none;
        }
        .emergency-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .event-header {
                flex-direction: column;
            }
            .action-buttons {
                width: 100%;
                justify-content: center;
                margin-top: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ЁЯОЙ ро╡ро┐ро┤ро╛ рокрогродрпН родрпКроХрпБрокрпНрокрпБ</h1>
            <p>роЙроЩрпНроХро│рпН ро╡ро┐ро┤ро╛ роиро┐родро┐роХро│рпИ роОро│ро┐родро╛роХ роиро┐ро░рпНро╡роХро┐роХрпНроХро╡рпБроорпН</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalEvents">0</div>
                <div class="stat-label">роорпКродрпНрод ро╡ро┐ро┤ро╛роХрпНроХро│рпН</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalParticipants">0</div>
                <div class="stat-label">роорпКродрпНрод рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalAmount">тВ╣0</div>
                <div class="stat-label">роорпКродрпНрод родрпКроХрпИ</div>
            </div>
        </div>

        <!-- Messages -->
        <div id="successMessage" class="success-message"></div>
        <div id="errorMessage" class="error-message"></div>

        <!-- Create Event Section -->
        <div class="card">
            <h2 class="section-title">ЁЯУЕ рокрпБродро┐роп ро╡ро┐ро┤ро╛ро╡рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН</h2>
            <div class="form-group">
                <input type="text" id="eventName" placeholder="ро╡ро┐ро┤ро╛ рокрпЖропро░рпН (роО.роХро╛: родро┐ро░рпБроорогроорпН)" class="form-input">
                <input type="text" id="eventType" placeholder="ро╡ро┐ро┤ро╛ ро╡роХрпИ (роО.роХро╛: родро┐ро░рпБроорогроорпН, рокро┐ро▒роирпНродроиро╛ро│рпН)" class="form-input">
                <input type="date" id="eventDate" class="form-input">
                <input type="text" id="eventLocation" placeholder="роЗроЯроорпН" class="form-input">
                <input type="number" id="eventTarget" placeholder="роЗро▓роХрпНроХрпБ родрпКроХрпИ (тВ╣)" class="form-input">
                <button id="createEventBtn" class="btn">ро╡ро┐ро┤ро╛ро╡рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН</button>
            </div>
        </div>

        <!-- Events List -->
        <div class="card">
            <h2 class="section-title">ЁЯУЛ роЙроЩрпНроХро│рпН ро╡ро┐ро┤ро╛роХрпНроХро│рпН</h2>
            <div id="eventsList">
                <div class="empty-state">
                    <p>роЗройрпНройрпБроорпН ро╡ро┐ро┤ро╛роХрпНроХро│рпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ. роорпБродро▓рпН ро╡ро┐ро┤ро╛ро╡рпИ роорпЗро▓рпЗ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН!</p>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div class="card">
            <h2 class="section-title">ЁЯУК роЕро▒ро┐роХрпНроХрпИроХро│рпН</h2>
            <div class="form-group">
                <select id="reportEvent" class="form-input">
                    <option value="">роЕро▒ро┐роХрпНроХрпИроХрпНроХро╛рой ро╡ро┐ро┤ро╛ро╡рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</option>
                </select>
                <div class="action-buttons">
                    <button id="generateReportBtn" class="btn">роЕро▒ро┐роХрпНроХрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН</button>
                    <button onclick="updateProgress()" class="btn btn-info">роорпБройрпНройрпЗро▒рпНро▒родрпНродрпИрокрпН рокро╛ро░рпН</button>
                </div>
            </div>
            <div id="eventProgress">
                <div class="empty-state">
                    <p>роорпБройрпНройрпЗро▒рпНро▒родрпНродрпИроХрпН роХро╛рог ро╡ро┐ро┤ро╛ро╡рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</p>
                </div>
            </div>
        </div>

        <!-- Emergency Delete Section -->
        <div class="card emergency-section">
            <h2 class="section-title">ЁЯЪи роЕро╡роЪро░ роирпАроХрпНроХрпБ</h2>
            <p>ро╡ро┐ро┤ро╛роХрпНроХро│рпИ роирпАроХрпНроХ роорпБроЯро┐ропро╛ро╡ро┐роЯрпНроЯро╛ро▓рпН, роЗроирпНрод рокрпКродрпНродро╛ройрпИ роЕро┤рпБродрпНродро╡рпБроорпН:</p>
            <div class="action-buttons">
                <button onclick="emergencyDelete()" class="btn btn-warning">рокро┐ро░роЪрпНроЪройрпИ ро╡ро┐ро┤ро╛роХрпНроХро│рпИ роирпАроХрпНроХрпБ</button>
                <button onclick="clearAllData()" class="btn btn-danger">роЕройрпИродрпНродрпБ родро░ро╡рпИропрпБроорпН роЕро┤ро┐</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let events = JSON.parse(localStorage.getItem('events')) || [];

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Page loaded! Events:", events);
            displayEvents();
            updateStats();
            updateEventDropdowns();
            
            document.getElementById('createEventBtn').addEventListener('click', createEvent);
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            
            if (events.length === 0) {
                showMessage('роиро▓рпНро╡ро░ро╡рпБ! роЙроЩрпНроХро│рпН роорпБродро▓рпН ро╡ро┐ро┤ро╛ро╡рпИ роЙро░рпБро╡ро╛роХрпНроХ родрпКроЯроЩрпНроХро╡рпБроорпН.', 'success');
            }
        });

        // Show message function
        function showMessage(message, type) {
            const successEl = document.getElementById('successMessage');
            const errorEl = document.getElementById('errorMessage');
            
            if (type === 'success') {
                successEl.textContent = message;
                successEl.style.display = 'block';
                errorEl.style.display = 'none';
                setTimeout(() => successEl.style.display = 'none', 5000);
            } else {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
                successEl.style.display = 'none';
                setTimeout(() => errorEl.style.display = 'none', 5000);
            }
        }

        // Create Event
        function createEvent() {
            const name = document.getElementById('eventName').value.trim();
            const type = document.getElementById('eventType').value.trim();
            const date = document.getElementById('eventDate').value;
            const location = document.getElementById('eventLocation').value.trim();
            const target = document.getElementById('eventTarget').value;

            if (!name || !date || !target) {
                showMessage('родропро╡рпБ роЪрпЖропрпНродрпБ ро╡ро┐ро┤ро╛ рокрпЖропро░рпН, родрпЗродро┐ рооро▒рпНро▒рпБроорпН роЗро▓роХрпНроХрпБ родрпКроХрпИропрпИ роиро┐ро░рокрпНрокро╡рпБроорпН', 'error');
                return;
            }

            const newEvent = {
                id: 'event_' + Date.now(), // Better ID format
                name: name,
                type: type,
                date: date,
                location: location,
                targetAmount: parseFloat(target),
                createdAt: new Date().toISOString(),
                participants: []
            };

            events.push(newEvent);
            localStorage.setItem('events', JSON.stringify(events));
            showMessage('тЬЕ ро╡ро┐ро┤ро╛ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯродрпБ: ' + name, 'success');
            
            // Clear form
            document.getElementById('eventName').value = '';
            document.getElementById('eventType').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventLocation').value = '';
            document.getElementById('eventTarget').value = '';

            displayEvents();
            updateStats();
            updateEventDropdowns();
        }

        // Add Participant to Event
        function addParticipant(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) {
                showMessage('ро╡ро┐ро┤ро╛ роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ', 'error');
                return;
            }

            const name = document.getElementById(`participantName_${eventId}`).value.trim();
            const phone = document.getElementById(`participantPhone_${eventId}`).value.trim();
            const place = document.getElementById(`participantPlace_${eventId}`).value.trim();
            const amount = document.getElementById(`participantAmount_${eventId}`).value;

            if (!name || !phone || !amount) {
                showMessage('родропро╡рпБ роЪрпЖропрпНродрпБ рокрпЖропро░рпН, родрпКро▓рпИрокрпЗроЪро┐ роОрогрпН рооро▒рпНро▒рпБроорпН родрпКроХрпИропрпИ роиро┐ро░рокрпНрокро╡рпБроорпН', 'error');
                return;
            }

            const newParticipant = {
                id: 'participant_' + Date.now(),
                name: name,
                phone: phone,
                place: place,
                amount: parseFloat(amount),
                createdAt: new Date().toISOString()
            };

            event.participants.push(newParticipant);
            localStorage.setItem('events', JSON.stringify(events));
            showMessage('тЬЕ рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯро╛ро░рпН: ' + name, 'success');
            
            document.getElementById(`participantName_${eventId}`).value = '';
            document.getElementById(`participantPhone_${eventId}`).value = '';
            document.getElementById(`participantPlace_${eventId}`).value = '';
            document.getElementById(`participantAmount_${eventId}`).value = '';

            displayEvents();
            updateStats();
            updateProgress();
        }

        // Delete Participant
        function deleteParticipant(eventId, participantId) {
            if (!confirm('роЗроирпНрод рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпИ роирпАроХрпНроХ ро╡рпЗрогрпНроЯрпБрооро╛?')) return;
            
            const event = events.find(e => e.id === eventId);
            if (event) {
                event.participants = event.participants.filter(p => p.id !== participantId);
                localStorage.setItem('events', JSON.stringify(events));
                displayEvents();
                updateStats();
                updateProgress();
                showMessage('рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпН роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ!', 'success');
            }
        }

        // Display Events - COMPLETELY FIXED VERSION
        function displayEvents() {
            const eventsList = document.getElementById('eventsList');

            if (events.length === 0) {
                eventsList.innerHTML = '<div class="empty-state"><p>роЗройрпНройрпБроорпН ро╡ро┐ро┤ро╛роХрпНроХро│рпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.</p></div>';
                return;
            }

            eventsList.innerHTML = events.map(event => {
                const participants = event.participants || [];
                const totalCollected = participants.reduce((sum, p) => sum + p.amount, 0);
                const progress = event.targetAmount > 0 ? (totalCollected / event.targetAmount * 100) : 0;
                const progressWidth = Math.min(progress, 100);

                // Use a data attribute for the event ID to avoid HTML issues
                return `
                    <div class="event-card" data-event-id="${event.id}">
                        <div class="event-header">
                            <div class="event-details">
                                <h3>${event.name}</h3>
                                <p><strong>ро╡роХрпИ:</strong> ${event.type || 'N/A'} | <strong>родрпЗродро┐:</strong> ${event.date} | <strong>роЗроЯроорпН:</strong> ${event.location || 'N/A'}</p>
                                <p><strong>роЗро▓роХрпНроХрпБ:</strong> тВ╣${event.targetAmount.toLocaleString()} | <strong>родро┐ро░роЯрпНроЯрокрпНрокроЯрпНроЯродрпБ:</strong> тВ╣${totalCollected.toLocaleString()} | <strong>роорпБройрпНройрпЗро▒рпНро▒роорпН:</strong> ${progress.toFixed(1)}%</p>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-danger btn-small delete-event-btn" data-event-id="${event.id}">ЁЯЧСя╕П ро╡ро┐ро┤ро╛ро╡рпИ роирпАроХрпНроХрпБ</button>
                            </div>
                        </div>

                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressWidth}%"></div>
                        </div>

                        <div class="participant-form">
                            <h4>ЁЯСе рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН</h4>
                            <input type="text" id="participantName_${event.id}" placeholder="роорпБро┤рпБ рокрпЖропро░рпН" class="form-input">
                            <input type="text" id="participantPhone_${event.id}" placeholder="родрпКро▓рпИрокрпЗроЪро┐ роОрогрпН" class="form-input">
                            <input type="text" id="participantPlace_${event.id}" placeholder="роЗроЯроорпН" class="form-input">
                            <input type="number" id="participantAmount_${event.id}" placeholder="родрпКроХрпИ (тВ╣)" class="form-input">
                            <button class="btn add-participant-btn" data-event-id="${event.id}">рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН</button>
                        </div>

                        <div>
                            <h4>ЁЯУЛ рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН (${participants.length})</h4>
                            ${participants.length === 0 ? 
                                '<div class="empty-state"><p>роЗройрпНройрпБроорпН рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ</p></div>' : 
                                participants.map(p => `
                                    <div class="participant-card">
                                        <div class="participant-info">
                                            <strong>${p.name}</strong>
                                            <div class="participant-details">
                                                ЁЯУЮ ${p.phone} | ЁЯУН ${p.place || 'N/A'} | ЁЯТ░ тВ╣${p.amount}
                                            </div>
                                        </div>
                                        <button class="btn btn-danger btn-small delete-participant-btn" 
                                                data-event-id="${event.id}" 
                                                data-participant-id="${p.id}">ЁЯЧСя╕П</button>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners after rendering
            setTimeout(() => {
                // Delete event buttons
                document.querySelectorAll('.delete-event-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const eventId = this.getAttribute('data-event-id');
                        deleteEvent(eventId);
                    });
                });

                // Add participant buttons
                document.querySelectorAll('.add-participant-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const eventId = this.getAttribute('data-event-id');
                        addParticipant(eventId);
                    });
                });

                // Delete participant buttons
                document.querySelectorAll('.delete-participant-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const eventId = this.getAttribute('data-event-id');
                        const participantId = this.getAttribute('data-participant-id');
                        deleteParticipant(eventId, participantId);
                    });
                });
            }, 100);
        }

        // DELETE EVENT - WORKING VERSION
        function deleteEvent(eventId) {
            console.log("Deleting event with ID:", eventId);
            console.log("Available events:", events.map(e => ({id: e.id, name: e.name})));
            
            if (!confirm('роЗроирпНрод ро╡ро┐ро┤ро╛ро╡рпИропрпБроорпН роЕройрпИродрпНродрпБ рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпИропрпБроорпН роирпАроХрпНроХ ро╡рпЗрогрпНроЯрпБрооро╛?')) {
                return;
            }

            const eventIndex = events.findIndex(event => event.id === eventId);
            
            if (eventIndex === -1) {
                showMessage('ро╡ро┐ро┤ро╛ роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ!', 'error');
                console.log("Event not found!");
                return;
            }

            // Remove the event
            const deletedEvent = events.splice(eventIndex, 1)[0];
            
            // Save to localStorage
            localStorage.setItem('events', JSON.stringify(events));
            
            // Update UI
            displayEvents();
            updateStats();
            updateEventDropdowns();
            
            showMessage(`"${deletedEvent.name}" ро╡ро┐ро┤ро╛ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ!`, 'success');
            console.log("Event deleted successfully. Remaining events:", events.length);
        }

        // Update Stats
        function updateStats() {
            document.getElementById('totalEvents').textContent = events.length;
            
            let totalParticipants = 0;
            let totalAmount = 0;
            
            events.forEach(event => {
                totalParticipants += (event.participants || []).length;
                totalAmount += (event.participants || []).reduce((sum, p) => sum + p.amount, 0);
            });
            
            document.getElementById('totalParticipants').textContent = totalParticipants;
            document.getElementById('totalAmount').textContent = `тВ╣${totalAmount.toLocaleString()}`;
        }

        // Update Event Dropdowns
        function updateEventDropdowns() {
            const eventOptions = events.map(event => 
                `<option value="${event.id}">${event.name} (${event.date})</option>`
            ).join('');

            document.getElementById('reportEvent').innerHTML = 
                '<option value="">ро╡ро┐ро┤ро╛ро╡рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</option>' + eventOptions;
        }

        // Update Progress
        function updateProgress() {
            const eventProgress = document.getElementById('eventProgress');
            const eventId = document.getElementById('reportEvent').value;

            if (!eventId) {
                eventProgress.innerHTML = '<div class="empty-state"><p>роорпБройрпНройрпЗро▒рпНро▒родрпНродрпИроХрпН роХро╛рог ро╡ро┐ро┤ро╛ро╡рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</p></div>';
                return;
            }

            const event = events.find(e => e.id === eventId);
            if (!event) return;

            const participants = event.participants || [];
            const totalCollected = participants.reduce((sum, p) => sum + p.amount, 0);
            const progress = event.targetAmount > 0 ? (totalCollected / event.targetAmount * 100) : 0;

            eventProgress.innerHTML = `
                <div style="text-align: center;">
                    <h3>${event.name} - роорпБройрпНройрпЗро▒рпНро▒роорпН</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                    </div>
                    <p><strong>тВ╣${totalCollected.toLocaleString()} / тВ╣${event.targetAmount.toLocaleString()}</strong></p>
                    <p><strong>${progress.toFixed(1)}% роорпБро┤рпБроорпИ</strong></p>
                    <p>${participants.length} рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН</p>
                </div>
            `;
        }

        // Generate Report - FIXED DOWNLOAD VERSION
        function generateReport() {
            const eventId = document.getElementById('reportEvent').value;
            if (!eventId) {
                showMessage('роЕро▒ро┐роХрпНроХрпИ роЙро░рпБро╡ро╛роХрпНроХ ро╡ро┐ро┤ро╛ро╡рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН', 'error');
                return;
            }

            const event = events.find(e => e.id === eventId);
            if (!event) {
                showMessage('ро╡ро┐ро┤ро╛ роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ', 'error');
                return;
            }

            const participants = event.participants || [];
            const totalCollected = participants.reduce((sum, p) => sum + p.amount, 0);
            const progress = event.targetAmount > 0 ? (totalCollected / event.targetAmount * 100) : 0;

            // Create report content
            const reportContent = `
ро╡ро┐ро┤ро╛ роЕро▒ро┐роХрпНроХрпИ
================

ро╡ро┐ро┤ро╛ рокрпЖропро░рпН: ${event.name}
ро╡ро┐ро┤ро╛ ро╡роХрпИ: ${event.type || 'N/A'}
родрпЗродро┐: ${event.date}
роЗроЯроорпН: ${event.location || 'N/A'}
роЗро▓роХрпНроХрпБ родрпКроХрпИ: тВ╣${event.targetAmount.toLocaleString()}
родро┐ро░роЯрпНроЯрокрпНрокроЯрпНроЯ родрпКроХрпИ: тВ╣${totalCollected.toLocaleString()}
роорпБройрпНройрпЗро▒рпНро▒роорпН: ${progress.toFixed(1)}%

рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН (${participants.length}):
${participants.map((p, index) => `${index + 1}. ${p.name} | ${p.phone} | ${p.place || 'N/A'} | тВ╣${p.amount}`).join('\n')}

роЪрпБро░рпБроХрпНроХроорпН:
---------
роорпКродрпНрод рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН: ${participants.length}
роорпКродрпНрод родро┐ро░роЯрпНроЯрокрпНрокроЯрпНроЯ родрпКроХрпИ: тВ╣${totalCollected.toLocaleString()}
роЗро▓роХрпНроХро┐ро▓рпН роЗро░рпБроирпНродрпБ роорпАродроорпН: тВ╣${(event.targetAmount - totalCollected).toLocaleString()}

роЕро▒ро┐роХрпНроХрпИ родрпЗродро┐: ${new Date().toLocaleDateString('ta-IN')}
            `.trim();

            // Create and download file
            try {
                const blob = new Blob([reportContent], { type: 'text/plain; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                // Clean filename - remove special characters
                const cleanEventName = event.name.replace(/[^a-zA-Z0-9\u0B80-\u0BFF]/g, '_');
                const fileName = `${cleanEventName}_роЕро▒ро┐роХрпНроХрпИ_${new Date().toISOString().split('T')[0]}.txt`;
                
                link.href = url;
                link.download = fileName;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up URL
                setTimeout(() => URL.revokeObjectURL(url), 100);
                
                showMessage('роЕро▒ро┐роХрпНроХрпИ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ рокродро┐ро╡ро┐ро▒роХрпНроХроорпН роЪрпЖропрпНропрокрпНрокроЯрпНроЯродрпБ!', 'success');
                console.log('Report downloaded:', fileName);
            } catch (error) {
                console.error('Download error:', error);
                showMessage('роЕро▒ро┐роХрпНроХрпИ рокродро┐ро╡ро┐ро▒роХрпНроХродрпНродро┐ро▓рпН рокро┐ро░роЪрпНроЪройрпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.', 'error');
                
                // Fallback: Show report in alert
                setTimeout(() => {
                    if (confirm('роЕро▒ро┐роХрпНроХрпИропрпИ рокро╛ро░рпНроХрпНроХ ро╡рпЗрогрпНроЯрпБрооро╛?')) {
                        alert(reportContent);
                    }
                }, 1000);
            }
        }

        // EMERGENCY DELETE - Delete problematic events
        function emergencyDelete() {
            if (!confirm('"kathukuthu" рооро▒рпНро▒рпБроорпН "pranith mottai function" ро╡ро┐ро┤ро╛роХрпНроХро│рпИ роирпАроХрпНроХ ро╡рпЗрогрпНроЯрпБрооро╛?')) return;
            
            const initialCount = events.length;
            events = events.filter(event => 
                event.name !== 'kathukuthu' && event.name !== 'pranith mottai function'
            );
            
            if (events.length < initialCount) {
                localStorage.setItem('events', JSON.stringify(events));
                displayEvents();
                updateStats();
                updateEventDropdowns();
                showMessage('рокро┐ро░роЪрпНроЪройрпИ ро╡ро┐ро┤ро╛роХрпНроХро│рпН роирпАроХрпНроХрокрпНрокроЯрпНроЯрой!', 'success');
            } else {
                showMessage('рокро┐ро░роЪрпНроЪройрпИ ро╡ро┐ро┤ро╛роХрпНроХро│рпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ', 'info');
            }
        }

        // CLEAR ALL DATA
        function clearAllData() {
            if (!confirm('роЕройрпИродрпНродрпБ ро╡ро┐ро┤ро╛роХрпНроХро│рпИропрпБроорпН рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпИропрпБроорпН роиро┐ро░роирпНродро░рооро╛роХ роирпАроХрпНроХ ро╡рпЗрогрпНроЯрпБрооро╛? роЗроирпНрод роЪрпЖропро▓рпИ родро┐ро░рпБроорпНрок рокрпЖро▒ роорпБроЯро┐ропро╛родрпБ!')) return;
            
            events = [];
            localStorage.setItem('events', JSON.stringify(events));
            displayEvents();
            updateStats();
            updateEventDropdowns();
            showMessage('роЕройрпИродрпНродрпБ родро░ро╡рпБроорпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роЕро┤ро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ!', 'success');
        }

        // Make functions global
        window.updateProgress = updateProgress;
        window.emergencyDelete = emergencyDelete;
        window.clearAllData = clearAllData;
    </script>
</body>
</html>
